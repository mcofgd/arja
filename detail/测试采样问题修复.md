# ARJA æµ‹è¯•é‡‡æ ·å¤±æ•ˆé—®é¢˜è¯Šæ–­ä¸ä¿®å¤

## ğŸ¯ é—®é¢˜æè¿°

åœ¨ Java 11 + Defects4J v3.0.1 ç¯å¢ƒä¸‹ï¼ŒARJA å‡ºç°æµ‹è¯•é‡‡æ ·å¤±æ•ˆçš„é—®é¢˜ï¼š

```
Line 113: Getting test executor, sample tests: 382  â† åº”è¯¥æ˜¯ 38ï¼ˆ10%ï¼‰
Line 116: Timeout occurs!  â† è¿è¡Œ 382 ä¸ªæµ‹è¯•è¶…æ—¶
```

å³ä½¿è®¾ç½®äº† `-Dpercentage 0.5`ï¼Œæµ‹è¯•é‡‡æ ·ä»ç„¶å¤±æ•ˆï¼Œå¯¼è‡´æ¯æ¬¡éƒ½è¿è¡Œå…¨éƒ¨ 382 ä¸ªæµ‹è¯•ï¼Œæœ€ç»ˆè¶…æ—¶ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜é“¾æ¡

```
test_arja_ns.sh å¯åŠ¨å‘½ä»¤
  â†“
âŒ ç¼ºå°‘ -Dpercentage å‚æ•°
  â†“
AbstractRepairProblem æ„é€ å‡½æ•°
  percentage = (Double) parameters.get("percentage")
  â†“
percentage = null
  â†“
getSamplePositiveTests() æ–¹æ³•
  if (percentage == null || percentage == 1)
      return positiveTests;  â† è¿”å›å…¨éƒ¨ 382 ä¸ªæµ‹è¯•
  â†“
invokeTestExecutor() æ”¶åˆ° 382 ä¸ªæµ‹è¯•
  â†“
æµ‹è¯•æ‰§è¡Œè¶…æ—¶ï¼ˆ1800 ç§’ï¼‰
  â†“
ç§ç¾¤æ— æ³•è¿›åŒ–
  â†“
æ°¸è¿œæ— æ³•ç”Ÿæˆè¡¥ä¸
```

### å…³é”®å‘ç°

1. **è„šæœ¬ç¼ºå°‘å‚æ•°**ï¼š`test_arja_ns.sh` ç¬¬255è¡Œæ²¡æœ‰è®¾ç½® `-Dpercentage` å‚æ•°
2. **é»˜è®¤å€¼é—®é¢˜**ï¼š`AbstractRepairProblem` ä¸­ `percentage` æ²¡æœ‰é»˜è®¤å€¼ï¼Œä¸º `null` æ—¶è¿”å›å…¨éƒ¨æµ‹è¯•
3. **è¶…æ—¶é—®é¢˜**ï¼šè¿è¡Œ 382 ä¸ªæµ‹è¯•éœ€è¦è¿œè¶… 1800 ç§’ï¼Œå¯¼è‡´é¢‘ç¹è¶…æ—¶

## âœ… å·²å®æ–½çš„ä¿®å¤

### ä¿®å¤1ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—ï¼ˆAbstractRepairProblem.javaï¼‰

**ä½ç½®**ï¼š`getSamplePositiveTests()` æ–¹æ³•

**ä¿®æ”¹å†…å®¹**ï¼š
```java
protected Set<String> getSamplePositiveTests() {
    // ... çœç•¥å‰é¢çš„ä»£ç  ...
    
    // âœ… æ·»åŠ è°ƒè¯•æ—¥å¿—
    System.out.println("DEBUG: getSamplePositiveTests() called");
    System.out.println("  percentage = " + percentage);
    System.out.println("  positiveTests.size() = " + positiveTests.size());
    
    if (percentage == null || percentage == 1) {
        System.out.println("  Returning all " + positiveTests.size() + " tests (no sampling)");
        return positiveTests;
    } else {
        int num = (int) (positiveTests.size() * percentage);
        System.out.println("  Calculated sample size: " + num + " (" + (percentage * 100) + "%)");
        
        // ... çœç•¥åé¢çš„ä»£ç  ...
    }
}
```

**ä½œç”¨**ï¼š
- è¾“å‡º `percentage` çš„å®é™…å€¼
- è¾“å‡ºé‡‡æ ·è®¡ç®—è¿‡ç¨‹
- å¸®åŠ©è¯Šæ–­é‡‡æ ·æ˜¯å¦ç”Ÿæ•ˆ

### ä¿®å¤2ï¼šæ·»åŠ  -Dpercentage å‚æ•°ï¼ˆtest_arja_ns.shï¼‰

**ä½ç½®**ï¼šç¬¬255è¡Œï¼ŒCMD å‘½ä»¤æ„å»º

**ä¿®æ”¹å‰**ï¼š
```bash
CMD="java ... \
    -DtestFiltered false \
    -DtestExecutorName \"$TEST_EXECUTOR\" \
    -DnoveltySearchMode none \
    -DmiFilterRule true \
    ..."
```

**ä¿®æ”¹å**ï¼š
```bash
# âœ… å…³é”®ä¿®å¤ï¼šæ·»åŠ  -Dpercentage 0.1 å‚æ•°ï¼Œåªè¿è¡Œ 10% çš„æµ‹è¯•
CMD="java ... \
    -Dpercentage 0.1 \
    -DtestFiltered false \
    -DtestExecutorName \"$TEST_EXECUTOR\" \
    -DnoveltySearchMode none \
    -DmiFilterRule false \
    ..."
```

**å…³é”®å˜åŒ–**ï¼š
1. **æ·»åŠ  `-Dpercentage 0.1`**ï¼šåªè¿è¡Œ 10% çš„æµ‹è¯•ï¼ˆ382 * 0.1 = 38 ä¸ªï¼‰
2. **ä¿®æ”¹ `-DmiFilterRule false`**ï¼šç¦ç”¨ MI è¿‡æ»¤è§„åˆ™ï¼Œé¿å…ä¿®æ”¹ç‚¹è¢«è¿‡æ»¤

### ä¿®å¤3ï¼šå…¶ä»–ä¼˜åŒ–

1. **ä¿ç•™ `-DtestFiltered false`**ï¼šç¦ç”¨æµ‹è¯•è¿‡æ»¤ï¼Œä½¿ç”¨å…¨éƒ¨ 382 ä¸ªæµ‹è¯•ä½œä¸ºåŸºç¡€
2. **ä¿ç•™ `-DseedLineGenerated true`**ï¼šå¯ç”¨ç§å­è¡Œæœºåˆ¶ï¼Œç¡®ä¿ä¿®æ”¹ç‚¹æ¥è‡ªé«˜å¯ç–‘è¡Œ
3. **ä¿ç•™ `-DingredientFilterRule true`**ï¼šå¯ç”¨ ingredient è¿‡æ»¤ï¼Œæé«˜è¡¥ä¸è´¨é‡

## ğŸš€ é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰
```
DEBUG: getSamplePositiveTests() called
  percentage = null
  positiveTests.size() = 382
  Returning all 382 tests (no sampling)
Getting test executor, sample tests: 382
Tests run completed, status: false, exceptional: true
Timeout occurs!
```

### ä¿®å¤åï¼ˆé¢„æœŸï¼‰
```
DEBUG: getSamplePositiveTests() called
  percentage = 0.1
  positiveTests.size() = 382
  Calculated sample size: 38 (10.0%)
âœ… Sampled 38 tests from 382
Getting test executor, sample tests: 38
Tests run completed, status: true, exceptional: false
Test execution completed successfully
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ |
|------|--------|--------|------|
| æµ‹è¯•æ•°é‡ | 382 | 38 | â†“ 90% |
| æµ‹è¯•æ—¶é—´ | >1800sï¼ˆè¶…æ—¶ï¼‰ | ~180s | â†“ 90% |
| è¶…æ—¶é¢‘ç‡ | é¢‘ç¹ | ç½•è§ | â†“ 95% |
| ç§ç¾¤è¿›åŒ–é€Ÿåº¦ | ææ…¢ | æ­£å¸¸ | â†‘ 10x |

## ğŸ”§ éªŒè¯æ­¥éª¤

### 1. é‡æ–°ç¼–è¯‘

```bash
cd ~/arja
mvn clean package -DskipTests
```

### 2. è¿è¡Œæµ‹è¯•

```bash
./test_arja_ns.sh
```

### 3. æ£€æŸ¥æ—¥å¿—

æŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

```bash
grep "DEBUG: getSamplePositiveTests" logs/arja_*.log
grep "Calculated sample size" logs/arja_*.log
grep "Getting test executor, sample tests" logs/arja_*.log
```

åº”è¯¥çœ‹åˆ°ï¼š
```
DEBUG: getSamplePositiveTests() called
  percentage = 0.1
  positiveTests.size() = 382
  Calculated sample size: 38 (10.0%)
âœ… Sampled 38 tests from 382
Getting test executor, sample tests: 38
```

### 4. éªŒè¯æˆåŠŸæ ‡å¿—

- âœ… æµ‹è¯•æ•°é‡ä» 382 é™åˆ° 38
- âœ… æµ‹è¯•æ‰§è¡Œä¸å†è¶…æ—¶
- âœ… ç§ç¾¤å¼€å§‹æ­£å¸¸è¿›åŒ–
- âœ… å‡ºç° `[GEN X] Best fitness = Y` æ—¥å¿—
- âœ… æœ€ç»ˆç”Ÿæˆ `.patch` æ–‡ä»¶

## ğŸ” å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### åœºæ™¯1ï¼špercentage ä»ç„¶æ˜¯ null

**æ’æŸ¥æ–¹æ³•**ï¼š
```bash
grep "percentage = " logs/arja_*.log
```

**å¯èƒ½åŸå› **ï¼š
- å‚æ•°ä¼ é€’å¤±è´¥ï¼ˆæ£€æŸ¥è„šæœ¬ä¸­çš„å¼•å·å’Œè½¬ä¹‰ï¼‰
- Main.java æœªæ­£ç¡®è§£æå‚æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç›´æ¥åœ¨å‘½ä»¤è¡Œæµ‹è¯•
java -cp ... us.msu.cse.repair.Main Arja -Dpercentage 0.1 ...
```

### åœºæ™¯2ï¼šé‡‡æ ·åä»ç„¶è¶…æ—¶

**å¯èƒ½åŸå› **ï¼š
- 38 ä¸ªæµ‹è¯•ä»ç„¶å¤ªå¤š
- æµ‹è¯•æœ¬èº«æ‰§è¡Œå¾ˆæ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# è¿›ä¸€æ­¥å‡å°‘æµ‹è¯•æ•°é‡
-Dpercentage 0.05  # 5%ï¼Œçº¦ 19 ä¸ªæµ‹è¯•
```

### åœºæ™¯3ï¼šmiFilterRule è¿‡æ»¤è¿‡å¤š

**ç°è±¡**ï¼š
```
No modification points selected, skipping evaluation
  Bits set: 0
  miFilterRule enabled: true
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
å·²åœ¨è„šæœ¬ä¸­è®¾ç½® `-DmiFilterRule false`

## ğŸ“ å…¶ä»–ç›¸å…³é—®é¢˜

### é—®é¢˜1ï¼šç¼–è¯‘å¤±è´¥

```
é”™è¯¯: å¯èƒ½å·²åˆ†é…å˜é‡numberOfSuccesses
```

**åŸå› **ï¼šARJA ç”Ÿæˆçš„è¡¥ä¸è¯•å›¾ä¿®æ”¹ `final` å˜é‡æˆ–åœ¨é”™è¯¯ä½ç½®æ’å…¥èµ‹å€¼è¯­å¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼ŒARJA ä¼šå°è¯•å¤šç§å˜å¼‚
- ç¼–è¯‘å¤±è´¥çš„ä¸ªä½“ä¼šè¢«è‡ªåŠ¨æ·˜æ±°
- ä¸å½±å“æ•´ä½“ä¿®å¤æµç¨‹

### é—®é¢˜2ï¼šNo modification points selected

**åŸå› **ï¼š`miFilterRule` è¿‡æ»¤æ‰äº†æ‰€æœ‰ä¿®æ”¹ç‚¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
å·²åœ¨è„šæœ¬ä¸­è®¾ç½® `-DmiFilterRule false`

## ğŸ¯ æ€»ç»“

### æ ¹æœ¬åŸå› 
**è„šæœ¬ç¼ºå°‘ `-Dpercentage` å‚æ•°**ï¼Œå¯¼è‡´ ARJA è¿è¡Œå…¨éƒ¨ 382 ä¸ªæµ‹è¯•ï¼Œæœ€ç»ˆè¶…æ—¶ã€‚

### æ ¸å¿ƒä¿®å¤
1. **æ·»åŠ  `-Dpercentage 0.1`**ï¼šåªè¿è¡Œ 10% çš„æµ‹è¯•
2. **æ·»åŠ è°ƒè¯•æ—¥å¿—**ï¼šè¿½è¸ªé‡‡æ ·è¿‡ç¨‹
3. **ç¦ç”¨ miFilterRule**ï¼šé¿å…ä¿®æ”¹ç‚¹è¢«è¿‡æ»¤

### é¢„æœŸç»“æœ
- âœ… æµ‹è¯•æ•°é‡ä» 382 é™åˆ° 38
- âœ… æµ‹è¯•æ—¶é—´ä» >1800s é™åˆ° ~180s
- âœ… ç§ç¾¤æ­£å¸¸è¿›åŒ–ï¼Œç”Ÿæˆè¡¥ä¸

---

**ä¿®å¤æ—¶é—´**ï¼š2025-12-18  
**ä¿®å¤æ–‡ä»¶**ï¼š
- `src/main/java/us/msu/cse/repair/core/AbstractRepairProblem.java`
- `test_arja_ns.sh`

**ä¿®å¤ç±»å‹**ï¼šå‚æ•°é…ç½® + è°ƒè¯•æ—¥å¿—